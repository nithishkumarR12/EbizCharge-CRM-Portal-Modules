<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="view_account_payment_form_inherit_payments" model="ir.ui.view">
            <field name="name">view.account.payment.form.inherit</field>
            <field name="model">account.payment.register</field>
            <field name="inherit_id" ref="account.view_account_payment_register_form"/>
            <field name="arch" type="xml">
                <field name="payment_token_id" position="attributes">
                    <attribute name="invisible">payment_method_code == 'ebizcharge'</attribute>
                    <attribute name="context">{'list_view_ref': 'payment_ebizcharge_crm.payment_token_multiple_view_credit_note'}</attribute>
                </field>
<!--                <field name="payment_token_id" position="attributes">-->
<!--                    <attribute name="string">Payment Method</attribute>-->
<!--                </field>-->
<!--                <field name="payment_method_line_id" position="attributes">-->
<!--                    <attribute name="invisible">1</attribute>-->
<!--                </field>-->
                <field name="payment_method_line_id" position="after">
                    <field invisible="1" name="journal_code"/>
                    <field invisible="1" name="sub_partner_id"/>
                </field>
                <field name="journal_id" position="after">
                    <field domain="['|',('company_id', '=', company_id), ('company_id', '=', False), ('is_valid_credential', '=', True), ('is_active', '=', True)]" invisible="1" name="ebiz_profile_id" options="{'no_create': True, 'no_open': True, 'no_quick_create': True}" readonly="is_ebiz_profile" string="EBizCharge Merchant Account"/>
                </field>
                <xpath expr="//group[2]" position="inside">
                    <field invisible="1" name="token_type"/>
                    <field invisible="payment_method_code != 'ebizcharge'" name="ebiz_send_receipt" />
                    <field invisible="1" name="ach_functionality_hide"/>
                    <field invisible="1" name="card_functionality_hide"/>
                    <field invisible="1" name="is_ebiz_profile"/>
                    <field invisible="1" name="ach_functionality_hide"/>
                    <field invisible="1" name="card_functionality_hide"/>
                    <field invisible="1" name="required_security_code"/>
                    <field invisible="1" name="is_surch_enable"/>
                    <field invisible="1" name="is_emv_enabled"/>

                </xpath>
                <xpath expr="//group[1]" position="after">
                    <group>
                        <field invisible="not ebiz_send_receipt or payment_method_code != 'ebizcharge'" name="ebiz_receipt_emails"/>
                    </group>

                    <field name="is_pay_link" invisible="1"/>
                    <div invisible="not is_pay_link"  class="fa fa-info-circle text-nowrap"
                    style="padding:10px;background-color:#E4D4E0;font-weight:bold;margin:2px;border-radius:4px;" >
                        This document has an existing payment link. Processing a payment using another method will invalidate the existing link.
                    </div>
                    
                    <notebook invisible="payment_method_code != 'ebizcharge'">
                        <page string="Cards" invisible="not card_functionality_hide">
                            <notebook>
                                <page class="child" name="credit_card" string="Saved Card">
                                    <group>
                                        <group>
                                            <field context="{'list_view_ref': 'payment_ebizcharge_crm.payment_token_multiple_view_test', 'default_token_type': 'credit'}" domain="[('partner_id','=',sub_partner_id),('token_type','=','credit'),('provider_id.code','=','ebizcharge')]" name="card_id" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit':True}"/>
                                            <field name="security_code" string="Security Code"/>
                                        </group>
                                    </group>
                                </page>
                                <page class="child" name="new_credit_card" string="New Card">
                                    <group>
                                        <group>
                                            <field name="card_account_holder_name" required="not card_id and token_type == 'credit'"/>
                                            <field name="card_card_number" required="not card_id and token_type == 'credit'"/>
                                            <label for="card_exp_month" string="Expiration Date *"/>
                                            <div class="o_address_format">
                                                <field name="card_exp_month" placeholder="MM" required="not card_id and token_type == 'credit'" style="width: 48%; margin-right: 2%;"/>
                                                <field name="card_exp_year" placeholder="YYYY" required="not card_id and token_type == 'credit'" style="width: 48%; margin-right: 0%;"/>
                                            </div>
                                            <label for="card_card_code" invisible="not required_security_code" string="Security Code *"/>
                                            <label for="card_card_code" invisible="required_security_code" string="Security Code"/>
                                            <field name="card_card_code" nolabel="1" required="not card_id and token_type == 'credit' and payment_method_code == 'ebizcharge' and required_security_code"/>
                                        </group>
                                        <group>
                                            <field name="card_avs_street" required="not card_id and token_type == 'credit'"/>
                                            <field name="card_avs_zip" required="not card_id and token_type == 'credit'"/>
                                            <field name="card_save"/>
                                        </group>
                                    </group>
                                </page>
                            </notebook>
                        </page>
                        <page invisible="not ach_functionality_hide" string="Bank Account">
                            <notebook>
                                <page class="child" name="bank" string="Saved Bank Account">
                                    <group>
                                        <field context="{'list_view_ref': 'payment_ebizcharge_crm.payment_token_ach_view_tree', 'default_token_type': 'ach'}"  domain="[('partner_id','=',partner_id),('token_type','=','ach'),('provider_id.code','=','ebizcharge')]" name="ach_id" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit':True}"/>
                                    </group>
                                </page>
                                <page class="child" name="new_bank" string="New Bank Account">
                                    <group>
                                        <group>
                                            <field name="ach_account_holder_name" required="not ach_id and token_type == 'ach'"/>
                                            <field name="ach_account_type" required="not ach_id and token_type == 'ach'"/>
                                            <field name="bank_account_save"/>
                                        </group>
                                        <group>
                                            <field name="ach_account" required="not ach_id and token_type == 'ach'"/>
                                            <field name="ach_routing" required="not ach_id and token_type == 'ach'"/>
                                        </group>
                                    </group>
                                </page>
                            </notebook>
                        </page>
                        <page invisible="is_emv_enabled == False" string="Pay By EMV">
                            <group>
                                <group>
                                    <field  string="EMV Device"  domain="[('merchant_id', '=', ebiz_profile_id)]"  name="emv_device_id" options='{"no_open": True, "no_create": True}'/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </xpath>
                <xpath expr="//button[@name='action_create_payments']" position="attributes">
                    <attribute name="string">Process</attribute>
                </xpath>
                <xpath expr="//footer/button[2]" position="attributes">
                    <attribute name="string">Process</attribute>
                </xpath>
                <xpath expr="//group[@name='group2']" position="after">
                    <group>
                        <group>
                        </group>
                        <group/>
                    </group>
                </xpath>
            </field>
        </record>

    </data>
</odoo>
