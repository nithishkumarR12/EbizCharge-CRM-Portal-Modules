<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="view_res_partner_ebizcharge_inh" model="ir.ui.view">
            <field name="name">res.partner.form.inh</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="payment.view_partners_form_payment_defaultcreditcard"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@name='button_box']/button[@name='%(payment.action_payment_token)d']/div/span[2]" position="replace">
                    <span class="o_stat_text">Credit Cards</span>
                </xpath>
                <xpath expr="//div[@name='button_box']/button[@name='%(payment.action_payment_token)d']" position="attributes">
                    <attribute name="context">{'search_default_partner_id': id, 'search_default_token_type': 'credit', 'create': False, 'edit': False, 'default_token_type': 'credit'}</attribute>
                </xpath>
            </field>
        </record>

        <record id="view_res_partner_ebizcharge" model="ir.ui.view">
            <field name="name">res.partner.form</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">

                <xpath expr="//sheet" position="before">
                    <header>
                        <field invisible="1" name="ach_functionality_hide"/>
                        <field invisible="1" name="card_functionality_hide"/>
                        <field invisible="1" name="customer_rank"/>
                        <field invisible="1" name="id"/>
                        <field invisible="1" name="ebiz_auto_sync"/>
                        <field invisible="1" name="ebiz_internal_id"/>
                        <field invisible="1" name="request_payment_method_sent"/>
                        <button class="oe_highlight" invisible="customer_rank == 0 or ebiz_internal_id or ebiz_auto_sync" name="sync_to_ebiz_ind" string="EBizCharge Upload" type="object"/>
                        <button class="oe_highlight" name="ebiz_request_payment_method" string="Request Payment Method" type="object"/>
                        <button class="oe_highlight" invisible="not card_functionality_hide" name="add_new_card" string="Add New Card" type="object"/>
                        <button class="oe_highlight" invisible="not ach_functionality_hide" name="add_new_ach" string="Add New Bank Account" type="object" context="{'partner_id': id}"/>
                    </header>
                </xpath>

                <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                    <button type="action" class="oe_stat_button"
                            icon="fa-bank"
                            name="%(payment_ebizcharge_crm.action_payment_token_tree)d"
                            context="{'search_default_partner_id': id, 'create': False, 'edit': False}"
                            invisible="payment_token_ach_count == 0 or not ach_functionality_hide">
                        <div class="o_form_field o_stat_info">
                            <span class="o_stat_value">
                                <field name="payment_token_ach_count" widget="statinfo" nolabel="1"/>
                            </span>
                            <span class="o_stat_text">Bank Accounts</span>
                        </div>
                    </button>
                </xpath>

                <field name="vat" position="after">
                    <field name="id" readonly="1" string="Customer Id"/>
                    <field invisible="1" name="ebiz_profile_ids"/>
                            <field domain="['|',('company_ids', 'in', ebiz_company_ids), ('id', 'in', ebiz_profile_ids)]"
                                   name="ebiz_profile_id" options="{'no_edit': True, 'no_create': True, 'no_open': True}"
                                    string="EBizCharge Merchant Account"/>
                    <field name="sync_status" readonly="1"/>
                </field>

                <xpath expr="//field[@name='category_id']" position="after">
                    <field invisible="1" name="ebiz_company_ids" widget="many2many_tags"/>
                </xpath>

                <xpath expr="//notebook/page[@name='sales_purchases']/group[1]/group[@name='misc']/field[@name='company_id']" position="replace">
                    <field domain="[('id', 'in', ebiz_company_ids)]" name="company_id"/>
                </xpath>

                <xpath expr="//notebook" position="inside">
                    <page invisible="not card_functionality_hide" name="ebiz_payments_credit_card" string="Credit Cards">
                        <button class="btn btn-secondary right_alignment" icon="fa-refresh" name="refresh_payment_methods" string="Refresh Payment Methods" style="right_alignment" type="object"/><br/><br/>
                        <field context="{'default_is_ebiz_charge': True}" mode="list" name="ebiz_credit_card_ids">
                            <form>
                                <group>
                                    <group>
                                        <field name="card_number" readonly="1"/>
                                        <field name="card_exp_month"/>
                                        <field name="card_exp_year"/>
                                        <field name="card_code"/>
                                    </group>
                                    <group>
                                        <field name="account_holder_name" readonly="1"/>
                                        <field name="avs_street" readonly="1"/>
                                        <field name="avs_zip" readonly="1"/>
                                        <field name="is_default" readonly="1" widget="boolean_toggle"/>
                                    </group>
                                </group>
                            </form>
                            <list create="0" delete="1">
                                <field name="account_holder_name" readonly="1" string="Name on Card"/>
                                <field name="card_number" readonly="1"/>
                                <field name="avs_street" readonly="1"/>
                                <field name="avs_zip" readonly="1"/>
                                <field name="card_exp_date"/>
                                <field name="is_default" readonly="1" widget="boolean_toggle"/>
                                <button aria-label="Delete row 1" class="fa fa-trash-o" name="delete_token" type="object"/>
                                <button class="fa fa-pencil" name="open_edit" title="Edit" type="object"/>
                            </list>
                        </field>
                    </page>
                    <page invisible="not ach_functionality_hide" name="ebiz_payments_bank" string="Bank Accounts">
                        <button class="btn btn-secondary right_alignment" icon="fa-refresh" name="refresh_payment_methods" string="Refresh Payment Methods" style="right_alignment" type="object"/><br/><br/>
                        <field context="{'default_is_ebiz_charge': True}"  mode="list" name="ebiz_ach_tokens">
                            <form>
                                <group>
                                    <group>
                                        <field name="account_holder_name"/>
                                        <field name="account_number" readonly="1"/>
                                        <field name="routing" readonly="1"/>
                                    </group>
                                    <group>
                                        <field name="account_type"/>
                                        <field name="is_default" widget="boolean_toggle"/>
                                    </group>
                                </group>
                            </form>
                            <list create="0" delete="1">
                                <field name="account_holder_name"/>
                                <field name="account_number" readonly="1"/>
                                <field name="routing" readonly="1"/>
                                <field name="account_type"/>
                                <field name="is_default" readonly="1" widget="boolean_toggle"/>
                                <button aria-label="Delete row 1" class="fa fa-trash-o" name="delete_token" type="object"/>
                                <button class="fa fa-pencil" name="open_edit" title="Edit" type="object"/>
                            </list>
                        </field>
                    </page>
                </xpath>
            </field>
        </record>

        

        <record id="view_res_partner_upload_tree" model="ir.ui.view">
            <field name="name">res.partner.form</field>
            <field name="model">res.partner</field>
            <field name="arch" type="xml">
                <list create="0">
                    <field name="name" string="Customer"/>
                    <field name="id" string="Customer ID"/>
                    <field name="email"/>
                    <field name="phone" string="Phone Number"/>
                    <field name="street"/>
                    <field name="city"/>
                    <field name="country_id"/>
                    <field name="last_sync_date"/>
                    <field name="sync_response"/>
                </list>
            </field>
        </record>

        <record id="view_partner_inherit_status_tree" model="ir.ui.view">
            <field name="name">res.partner.followup.inherit.tree</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_tree"/>
            <field name="arch" type="xml">
                <field name="vat" position="after">
                    <field name="sync_status" optional="show"/>
                </field>
            </field>
        </record>

        <record id="action_res_partner_sync_tree" model="ir.actions.act_window">
            <field name="name">Upload Customers</field>
            <field name="res_model">res.partner</field>
            <field name="view_mode">tree</field>
            <field name="domain">[('customer_rank','>', 0)]</field>
            <field name="context">{'ebiz_upload_customer_action':1}</field>
            <field name="view_id" ref="view_res_partner_upload_tree"/>
        </record>
                <!--Server Action-->
        <record id="model_action_wizard_customer_multi_sync" model="ir.actions.server">
            <field name="name">EBizCharge Upload</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="binding_model_id" ref="base.model_res_partner"/>
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">action = records.sync_multi_customers()</field>
        </record>

        <record id="model_customer_multi_payments_methods_req" model="ir.actions.server">
            <field name="name">Request Payment Method</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="binding_model_id" ref="base.model_res_partner"/>
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">action = records.request_payment_methods_bulk()</field>
        </record>

    </data>
</odoo>
